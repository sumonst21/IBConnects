$.wa=$.ui?$.extend(!0,$.wa,$.ui):{};
$.wa=$.extend(!0,$.wa,{data:{},get:function(a,d){return a==void 0?this.data:this.data[name]||d||null},set:function(a){if(a==void 0)return this.data;typeof a=="object"?$.extend(this.data,a):this.data[a]=value;return this.data},encodeHTML:function(a){return a&&(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},decodeHTML:function(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},setHash:function(a){!(a instanceof String)&&a.toString&&(a=a.toString());
a=a.replace(/\/\//g,"/");a=a.replace(/^.*#/,"");parent&&!$.browser.msie?parent.window.location.hash=a:location.hash=a;return true},back:function(a){history.length>2?typeof a=="number"&&parseInt(a)==a?history.go(-a):history.go(-1):$.browser.msie&&history.length>0?history.back():a&&this.setHash(a);return false},toggleHashParam:function(a){location.hash.search(a)==-1?this.addToHash(a):this.removeFromHash(a)},addToHash:function(a){var d=location.hash;d.search(a)==-1&&(d=d+("/"+a+"/"));this.setHash(d)},
removeFromHash:function(a){var d=location.hash;d.search(a)>-1&&(d=d.replace(a,""));this.setHash(d)},setTitle:function(a){document.title=a},array_search:function(a,d,b){var b=!!b,c;for(c in d)if(b&&d[c]===a||!b&&d[c]==a)return c;return false},dialogCreate:function(a,d){d=$.extend({content:'<h1>Loading... <i class="icon16 loading"></i></h1>',buttons:null,url:null,post:null,small:false,onload:null,oncancel:null},d);d.content=$(d.content);d.buttons=d.buttons?$(d.buttons):$('<input type="submit" class="button gray" value="'+
$_("Cancel")+'">').click(function(){d.oncancel&&d.oncancel.call(b[0]);$.wa.dialogHide()});var b=$("#"+a);b.size()<=0&&(b=$('<div class="dialog" id="'+a+'" style="display: none"><div class="dialog-background"></div><div class="dialog-window"><div class="dialog-content"><div class="dialog-content-indent"></div></div><div class="dialog-buttons"><div class="dialog-buttons-gradient"></div></div></div></div>').appendTo("body"));b.find(".dialog-buttons-gradient").empty().append(d.buttons);b.find(".dialog-content-indent").empty().append(d.content);
b.show();d.small?b.addClass("small"):b.removeClass("small");if(d.url){var c=function(a){b.find(".dialog-content-indent").html(a);$.wa.waCenterDialog(b);d.onload&&d.onload.call(b[0])};d.post?$.post(d.url,d.post,c):$.get(d.url,c)}this.waCenterDialog(b);var e=function(a){if(b.is(":visible"))if(a&&a.keyCode==27){d.oncancel&&typeof d.oncancel=="function"&&d.oncancel.call(b[0]);$.wa.dialogHide()}else $(document).one("keyup",e)};e();$(document).one("hashchange",$.wa.dialogHide);return b},waCenterDialog:function(a){var a=
$(a),a=a.find(".dialog-window"),d=a.outerWidth(true),b=a.outerHeight(true),c=$(window).width(),e=$(window).height(),b=(e-b)/2/e;a.css({left:Math.round((c-d)/2/c*100)+"%",top:Math.round(b*100)+"%"})},dialogHide:function(){$(".dialog").hide();return false},dropdownsClose:function(){var a=$(".dropdown:not(.disabled)");a.addClass("disabled");setTimeout(function(){a.removeClass("disabled")},600)},dropdownsCloseEnable:function(){$(".dropdown:not(.disabled)").live("click",this.dropdownsClickHandler)},dropdownsCloseDisable:function(){$(".dropdown:not(.disabled)").die("click",
this.dropdownsClickHandler)},dropdownsClickHandler:function(){var a=$(this);if(!a.hasClass("no-click-close")){a.addClass("disabled");setTimeout(function(){a.removeClass("disabled")},600)}},defaultInputValue:function(a,d,b){a instanceof jQuery||(a=$(a));var c=function(){var e=a.val();if(!e||e==d){a.val(d);a.addClass(b)}};c();a.blur(c);a.focus(function(){if(a.hasClass(b)){a.removeClass(b);a.val("")}})},util:{formatFileSize:function(a){var d=-1;do{a=a/1024;d++}while(a>99);return Math.max(a,0.01).toFixed(2)+
(d>=0?" "+$_(["kB","MB","GB","TB","PB","EB"][d]):"")}}});
$(document).ajaxError(function(a,d){if(200!==d.status&&d.responseText){if(!$.wa.errorHandler||$.wa.errorHandler(d))-1!=d.responseText.indexOf("Exception")?$.wa.dialogCreate("ajax-error",{content:"<div>"+d.responseText+"</div>"}):(document.open("text/html"),document.write(d.responseText),document.close(),$(window).one("hashchange",function(){window.location.reload()}))}else d.getResponseHeader("wa-session-expired")?window.location.reload():"undefined"!==typeof d.responseText&&-1!=d.responseText.indexOf("Exception")&&
$.wa.dialogCreate("ajax-error",{content:"<div>"+d.responseText+"</div>"})});$.ajaxSetup({cache:!1});$(document).ajaxSend(function(a,d,b){"POST"==b.type&&((a=(a=document.cookie.match(/(?:^|; )_csrf=([^;]*)/))?decodeURIComponent(a[1]):"",null===b.data&&(b.data=""),"string"==typeof b.data)?-1==b.data.indexOf("_csrf=")&&(b.data+=(0<b.data.length?"&":"")+"_csrf="+a,d.setRequestHeader("Content-type","application/x-www-form-urlencoded")):"object"==typeof b.data&&(b.data._csrf=a))});
Array.prototype.indexOf||(Array.prototype.indexOf=function(a,d){var b=this.length,c=Number(d)||0,c=0>c?Math.ceil(c):Math.floor(c);for(0>c&&(c+=b);c<b;c++)if(c in this&&this[c]===a)return c;return-1});$.wa.locale=$.wa.locale||{};
$_=function(a,d){if(d){if(!$.wa.locale[d]){console&&console.log("Localization failed: "+d);return d}if(typeof $.wa.locale[d]=="string")return $.wa.locale[d];var b=a%10;return Math.floor(a/10)%10==1||b>4||b==0?$.wa.locale[d][2]||$.wa.locale[d][1]:b==1?$.wa.locale[d][0]:$.wa.locale[d][1]}if($.wa.locale[a])return typeof $.wa.locale[a]=="string"?$.wa.locale[a]:$.wa.locale[a][0];console&&console.log("Localization failed: "+a);return a};jQuery.fn.waDialog=function(a){var a=jQuery.extend({loading_header:"",title:"",esc:!0,buttons:null,url:null,url_reload:!0,"class":null,content:null,width:0,height:0,"min-width":0,"min-height":0,offsetTop:null,offsetLeft:null,disableButtonsOnSubmit:!1,onLoad:null,onCancel:null,onSubmit:null},a||{}),d=$(this),b=d.attr("id");b&&!d.hasClass("dialog")&&(d.removeAttr("id"),$("#"+b).length&&(a.url?(d=$("#"+b),a.url_reload||(a.url=null)):$("#"+b).remove()));var c=a["class"]||a.className?a["class"]||a.className:
d.attr("class")||"";if(d.hasClass("dialog"))a.content&&(d.find(".dialog-content-indent").html(a.content),a.title&&d.find(".dialog-content-indent").prepend("<h1>"+a.title+"</h1>")),a.buttons&&d.find(".dialog-buttons-gradient").empty().append(a.buttons);else{var e=$(this),d=$("<div "+(b?'id = "'+b+'"':"")+' class="dialog '+c+'" style="display: none"><div class="dialog-background"></div><div class="dialog-window"></div></div>').appendTo("body");if(e.find(".dialog-content").length||e.find(".dialog-buttons").length){if($(".dialog-window",
d).append(e.show()),b=e.find(".dialog-content"),b.length&&(c=$('<div class="dialog-content-indent"></div>'),b.contents().appendTo(c),b.append(c)),b=e.find(".dialog-buttons"),b.length)c=$('<div class="dialog-buttons-gradient"></div>'),b.contents().appendTo(c),b.append(c)}else $(".dialog-window",d).append((a.onSubmit?'<form method="post" action="">':"")+'<div class="dialog-content"><div class="dialog-content-indent"></div></div><div class="dialog-buttons"><div class="dialog-buttons-gradient"></div></div>'+
(a.onSubmit?"</form>":"")),d.find(".dialog-content-indent").append(e.show());a.buttons&&d.find(".dialog-buttons-gradient").empty().append(a.buttons);a.url?d.find(".dialog-content-indent").append("<h1>"+(a.loading_header||"")+'<i class="icon16 loading"></i></h1>'):a.content&&d.find(".dialog-content-indent").append(a.content);a.title&&d.find(".dialog-content-indent").prepend("<h1>"+a.title+"</h1>")}d.find(".dialog-background").length||d.prepend('<div class="dialog-background"> </div>');d.unbind("close").bind("close",
function(){a.onClose&&a.onClose.call($(this));$(this).hide()});e=["width","height","min-width","min-height"];for(b=0;b<e.length;b++)a[e[b]]&&(("height"==e[b]&&"300px">a[e[b]]||"width"==e[b]&&"400px">a[e[b]])&&d.find("div.dialog-window").css("min-"+e[b],a[e[b]]),d.find("div.dialog-window").css(e[b],a[e[b]]));a.disableButtonsOnSubmit&&d.find("input[type=submit]").removeAttr("disabled");d.parent().length||d.appendTo("body");d.show();a.url?jQuery.get(a.url,function(b){var e=$(b);if(e.find(".dialog-content").length||
e.find(".dialog-buttons").length){e.find(".dialog-content").length&&d.find(".dialog-content-indent").empty().append(e.find(".dialog-content").contents());e.find(".dialog-buttons").length&&d.find(".dialog-buttons-gradient").empty().append(e.find(".dialog-buttons").contents())}else d.find(".dialog-content-indent").html(b);d.trigger("wa-resize");a.onLoad&&a.onLoad.call(d.get(0))}):a.onLoad&&a.onLoad.call(d.get(0));d.find(".dialog-buttons").delegate(".cancel","click",function(b){b.stopPropagation();b.preventDefault();
a.onCancel&&a.onCancel.call(d.get(0));d.trigger("close");return false});a.onSubmit&&d.find("form").unbind("submit").submit(function(){a.disableButtonsOnSubmit&&d.find("input[type=submit]").attr("disabled","disabled");return a.onSubmit.apply(this,[d])});d.unbind("wa-resize").bind("wa-resize",function(){var b=jQuery(this).find(".dialog-window"),e=b.width(),c=b.height();jQuery("body").css("min-height",c+"px");var d=jQuery(window).width(),i=jQuery(window).height()-60,e=(d-e)/2/d,c=(i-c-60)/2/i;c<0&&(c=
0);e<0&&(e=0);b.css({left:a.offsetLeft||Math.round(e*100)+"%",top:a.offsetTop||Math.round(c*100)+"%"})}).trigger("wa-resize");a.esc&&d.unbind("esc").bind("esc",function(){d.trigger("close")});return d};jQuery(window).resize(function(){jQuery(".dialog:visible").trigger("wa-resize")});jQuery(document).keyup(function(a){27==a.keyCode&&jQuery(".dialog:visible").trigger("esc")});/*
 GNU Affero General Public License - {@link http://www.gnu.org/licenses/agpl.html}
 @example Visit {@link http://jquery.com/plugins/project/jquery_history_bal} for more information.


 I would like to take this space to thank the following projects, blogs, articles and people:
 - jQuery {@link http://jquery.com/}
 - jQuery UI History - Klaus Hartl {@link http://www.stilbuero.de/jquery/ui_history/}
 - Really Simple History - Brian Dillard and Brad Neuberg {@link http://code.google.com/p/reallysimplehistory/}
 - jQuery History Plugin - Taku Sano (Mikage Sawatari) {@link http://www.mikage.to/jquery/jquery_history.html}
 - jQuery History Remote Plugin - Klaus Hartl {@link http://stilbuero.de/jquery/history/}
 - Content With Style: Fixing the back button and enabling bookmarking for ajax apps - Mike Stenhouse {@link http://www.contentwithstyle.co.uk/Articles/38/fixing-the-back-button-and-enabling-bookmarking-for-ajax-apps}
 - Bookmarks and Back Buttons {@link http://ajax.howtosetup.info/options-and-efficiencies/bookmarks-and-back-buttons/}
 - Ajax: How to handle bookmarks and back buttons - Brad Neuberg {@link http://dev.aol.com/ajax-handling-bookmarks-and-back-button}



 CHANGELOG

 v1.0.1-final, July 11, 2009
 - Restructured a little bit
 - Documented
 - Cleaned go/request

 v1.0.0-final, June 19, 2009
 - Been stable for over a year now, pushing live.

 v0.1.0-dev, July 24, 2008
 - Initial Release

*/
(function(a){"undefined"===typeof console&&(console="undefined"!==typeof window.console?window.console:{});console.log=console.log||function(){};console.debug=console.debug||console.log;console.warn=console.warn||console.log;console.error=console.error||function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);alert(a.join("\n"))};console.trace=console.trace||console.log;console.group=console.group||console.log;console.groupEnd=console.groupEnd||console.log;console.profile=console.profile||
console.log;console.profileEnd=console.profileEnd||console.log;a.History={options:{debug:!1},state:"",$window:null,$iframe:null,handlers:{generic:[],specific:{}},format:function(a){return a=a.replace(/^.+?#/g,"").replace(/^#?\/?|\/?$/g,"")},getState:function(){return a.History.state},setState:function(d){var b=a.History,d=b.format(d);b.state=d;return b.state},getHash:function(){var d=parent&&!a.browser.msie?parent.window.location.hash:window.location.hash||location.hash;return d=a.History.format(d)},
setHash:function(d){d=a.History.format(d);d=d.replace(/^\/?|\/?(\?)|\/?$/g,"/$1");"undefined"===typeof window.location.hash&&(location.hash=d);a.browser.msie&&8>parseInt(a.browser.version,10)&&(a.History.$iframe.contentWindow.document.open(),a.History.$iframe.contentWindow.document.close())},go:function(d){var b=a.History,d=b.format(d);b.getHash()!==d?b.setHash(d):(b.setState(d),b.trigger());return!0},hashchange:function(d){var b=a.History;b.options.debug&&console.debug("History.hashchange",this,
arguments);var c=b.getHash(),e=b.getState();if(!b.$iframe&&e===c||b.$iframe&&b.hash===b.$iframe.contentWindow.document.location.hash||e===c)return!1;b.setState(c);b.trigger();return!0},bind:function(d,b){var c=a.History;b?("undefined"===typeof c.handlers.specific[d]&&(c.handlers.specific[d]=[]),c.handlers.specific[d].push(b)):c.handlers.generic.push(d);return!0},trigger:function(d){var b=a.History;"undefined"===typeof d&&(d=b.getState());var c,e,h,f;if("undefined"!==typeof b.handlers.specific[d]){f=
b.handlers.specific[d];c=0;for(e=f.length;c<e;++c)h=f[c],h(d)}f=b.handlers.generic;c=0;for(e=f.length;c<e;++c)h=f[c],h(d);return!0},construct:function(){var d=a.History;a(document).ready(function(){d.domReady()});return!0},configure:function(d){var b=a.History;b.options=a.extend(b.options,d);return!0},domReadied:!1,domReady:function(){var d=a.History;if(!d.domRedied)return d.domRedied=!0,d.$window=a(window),d.$window.bind("hashchange",this.hashchange),setTimeout(d.hashchangeLoader,200),!0},hashchangeLoader:function(){var d=
a.History;if(a.browser.msie&&8<=parseInt(a.browser.version))(b=d.getHash())&&d.$window.trigger("hashchange");else{if(a.browser.msie){d.$iframe=a('<iframe id="jquery-history-iframe" style="display: none;"></$iframe>').prependTo(document.body)[0];d.$iframe.contentWindow.document.open();d.$iframe.contentWindow.document.close();var b=d.getHash();b&&(d.$iframe.contentWindow.document.location.hash=b);b=function(){var b=d.format(d.$iframe.contentWindow.document.location.hash);d.getState()!==b&&d.setHash(d.$iframe.contentWindow.document.location.hash);
b=d.getHash();d.getState()!==b&&d.go(b)}}else b=function(){var b=d.getHash();d.getState()!==b&&d.go(b)};a.browser.msie&&8>parseInt(a.browser.version)?setInterval(b,1500):setInterval(b,200)}return!0}};a.History.construct()})(jQuery);(function(a,d){a.store=function(b,c){var e=this;if("string"==typeof b)if(a.store.drivers[b])this.driver=a.store.drivers[b];else throw Error("Unknown driver "+b);else if("object"==typeof b){if(!a.isFunction(b.init)||!a.isFunction(b.get)||!a.isFunction(b.set)||!a.isFunction(b.del)||!a.isFunction(b.flush))throw Error("The specified driver does not fulfill the API requirements");this.driver=b}else a.each(a.store.drivers,function(){if(!a.isFunction(this.available)||!this.available())return!0;e.driver=
this;return!1===e.driver.init()?(e.driver=null,!0):!1});c||(c=a.store.serializers);this.serializers={};a.each(c,function(b){if(!a.isFunction(this.init))return true;e.serializers[b]=this;e.serializers[b].init(e.encoders,e.decoders)})};a.extend(a.store.prototype,{get:function(b){b=this.driver.get(b);return this.driver.encodes?b:this.unserialize(b)},set:function(b,a){this.driver.set(b,this.driver.encodes?a:this.serialize(a))},del:function(b){this.driver.del(b)},flush:function(){this.driver.flush()},
driver:d,encoders:[],decoders:[],serialize:function(b){var c=this;a.each(this.encoders,function(){var a=c.serializers[this+""];if(!a||!a.encode)return!0;try{b=a.encode(b)}catch(d){}});return b},unserialize:function(b){var c=this;if(!b)return b;a.each(this.decoders,function(){var a=c.serializers[this+""];if(!a||!a.decode)return!0;b=a.decode(b)});return b}});a.store.drivers={localStorage:{ident:"$.store.drivers.localStorage",scope:"browser",available:function(){try{return!!window.localStorage}catch(b){return!1}},
init:a.noop,get:function(b){return window.localStorage.getItem(b)},set:function(b,a){window.localStorage.setItem(b,a)},del:function(a){window.localStorage.removeItem(a)},flush:function(){window.localStorage.clear()}},userData:{ident:"$.store.drivers.userData",element:null,nodeName:"userdatadriver",scope:"browser",initialized:!1,available:function(){try{return!(!document.documentElement||!document.documentElement.addBehavior)}catch(a){return!1}},init:function(){if(!this.initialized)try{this.element=
document.createElement(this.nodeName),document.documentElement.insertBefore(this.element,document.getElementsByTagName("title")[0]),this.element.addBehavior("#default#userData"),this.initialized=!0}catch(a){return!1}},get:function(a){this.element.load(this.nodeName);return this.element.getAttribute(a)},set:function(a,c){this.element.setAttribute(a,c);this.element.save(this.nodeName)},del:function(a){this.element.removeAttribute(a);this.element.save(this.nodeName)},flush:function(){this.element.expires=
(new Date).toUTCString();this.element.save(this.nodeName)}},windowName:{ident:"$.store.drivers.windowName",scope:"window",cache:{},encodes:!0,available:function(){return!0},init:function(){this.load()},save:function(){window.name=a.store.serializers.json.encode(this.cache)},load:function(){try{this.cache=a.store.serializers.json.decode(window.name+""),"object"!=typeof this.cache&&(this.cache={})}catch(b){this.cache={},window.name="{}"}},get:function(a){return this.cache[a]},set:function(a,c){this.cache[a]=
c;this.save()},del:function(a){try{delete this.cache[a]}catch(c){this.cache[a]=d}this.save()},flush:function(){window.name="{}"}}};a.store.serializers={json:{ident:"$.store.serializers.json",init:function(a,c){a.push("json");c.push("json")},encode:"object"==typeof JSON?JSON.stringify:a.JSON.stringify,decode:"object"==typeof JSON?JSON.parse:a.JSON.parse},xml:{ident:"$.store.serializers.xml",init:function(a,c){a.unshift("xml");c.push("xml")},isXML:function(a){return(a=(a?a.ownerDocument||a:0).documentElement)?
"html"!==a.nodeName.toLowerCase():!1},encode:function(a){if(!a||a._serialized||!this.isXML(a))return a;var c={_serialized:this.ident,value:a};try{return c.value=(new XMLSerializer).serializeToString(a),c}catch(e){try{return c.value=a.xml,c}catch(d){}}return a},decode:function(a){if(!a||!a._serialized||a._serialized!=this.ident)return a;var c="DOMParser"in window&&(new DOMParser).parseFromString;!c&&window.ActiveXObject&&(c=function(a){var b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);
return b});if(!c)return d;a.value=c.call("DOMParser"in window&&new DOMParser||window,a.value,"text/xml");return this.isXML(a.value)?a.value:d}}}})(jQuery);(function(a){a.ui=a.ui||{};var d=/left|center|right/,b=/top|center|bottom/,c={},e=a.fn.position,h=a.fn.offset;a.fn.position=function(h){if(!h||!h.of)return e.apply(this,arguments);var h=a.extend({},h),f=a(h.of),g=f[0],j=(h.collision||"flip").split(" "),i=h.offset?h.offset.split(" "):[0,0],k,q,m;return 9===g.nodeType?(k=f.width(),q=f.height(),m={top:0,left:0}):g.setTimeout?(k=f.width(),q=f.height(),m={top:f.scrollTop(),left:f.scrollLeft()}):g.preventDefault?(h.at="left top",k=q=0,m={top:h.of.pageY,
left:h.of.pageX}):(k=f.outerWidth(),q=f.outerHeight(),m=f.offset()),a.each(["my","at"],function(){var a=(h[this]||"").split(" ");1===a.length&&(a=d.test(a[0])?a.concat(["center"]):b.test(a[0])?["center"].concat(a):["center","center"]);a[0]=d.test(a[0])?a[0]:"center";a[1]=b.test(a[1])?a[1]:"center";h[this]=a}),1===j.length&&(j[1]=j[0]),i[0]=parseInt(i[0],10)||0,1===i.length&&(i[1]=i[0]),i[1]=parseInt(i[1],10)||0,"right"===h.at[0]?m.left+=k:"center"===h.at[0]&&(m.left+=k/2),"bottom"===h.at[1]?m.top+=
q:"center"===h.at[1]&&(m.top+=q/2),m.left+=i[0],m.top+=i[1],this.each(function(){var b=a(this),e=b.outerWidth(),d=b.outerHeight(),f=parseInt(a.curCSS(this,"marginLeft",!0))||0,g=parseInt(a.curCSS(this,"marginTop",!0))||0,p=e+f+(parseInt(a.curCSS(this,"marginRight",!0))||0),u=d+g+(parseInt(a.curCSS(this,"marginBottom",!0))||0),l=a.extend({},m),t;"right"===h.my[0]?l.left-=e:"center"===h.my[0]&&(l.left-=e/2);"bottom"===h.my[1]?l.top-=d:"center"===h.my[1]&&(l.top-=d/2);c.fractions||(l.left=Math.round(l.left),
l.top=Math.round(l.top));t={left:l.left-f,top:l.top-g};a.each(["left","top"],function(b,c){a.ui.position[j[b]]&&a.ui.position[j[b]][c](l,{targetWidth:k,targetHeight:q,elemWidth:e,elemHeight:d,collisionPosition:t,collisionWidth:p,collisionHeight:u,offset:i,my:h.my,at:h.at})});a.fn.bgiframe&&b.bgiframe();b.offset(a.extend(l,{using:h.using}))})};a.ui.position={fit:{left:function(b,e){var c=a(window),c=e.collisionPosition.left+e.collisionWidth-c.width()-c.scrollLeft();b.left=0<c?b.left-c:Math.max(b.left-
e.collisionPosition.left,b.left)},top:function(b,e){var c=a(window),c=e.collisionPosition.top+e.collisionHeight-c.height()-c.scrollTop();b.top=0<c?b.top-c:Math.max(b.top-e.collisionPosition.top,b.top)}},flip:{left:function(b,e){if("center"!==e.at[0]){var c=a(window),c=e.collisionPosition.left+e.collisionWidth-c.width()-c.scrollLeft(),d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,h="left"===e.at[0]?e.targetWidth:-e.targetWidth,f=-2*e.offset[0];b.left+=0>e.collisionPosition.left?d+
h+f:0<c?d+h+f:0}},top:function(b,e){if("center"!==e.at[1]){var c=a(window),c=e.collisionPosition.top+e.collisionHeight-c.height()-c.scrollTop(),d="top"===e.my[1]?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,h="top"===e.at[1]?e.targetHeight:-e.targetHeight,f=-2*e.offset[1];b.top+=0>e.collisionPosition.top?d+h+f:0<c?d+h+f:0}}}};a.offset.setOffset||(a.offset.setOffset=function(b,e){/static/.test(a.curCSS(b,"position"))&&(b.style.position="relative");var c=a(b),d=c.offset(),h=parseInt(a.curCSS(b,"top",
!0),10)||0,f=parseInt(a.curCSS(b,"left",!0),10)||0,d={top:e.top-d.top+h,left:e.left-d.left+f};"using"in e?e.using.call(b,d):c.css(d)},a.fn.offset=function(b){var e=this[0];return!e||!e.ownerDocument?null:b?a.isFunction(b)?this.each(function(e){a(this).offset(b.call(this,e,a(this).offset()))}):this.each(function(){a.offset.setOffset(this,b)}):h.call(this)});a.curCSS||(a.curCSS=a.css);var f=document.getElementsByTagName("body")[0],g=document.createElement("div"),j,i;j=document.createElement(f?"div":
"body");i={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};f&&a.extend(i,{position:"absolute",left:"-1000px",top:"-1000px"});for(var k in i)j.style[k]=i[k];j.appendChild(g);i=f||document.documentElement;i.insertBefore(j,i.firstChild);g.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;";g=a(g).offset(function(a,b){return b}).offset();j.innerHTML="";i.removeChild(j);f=g.top+g.left+(f?2E3:0);c.fractions=21<f&&22>f})(jQuery);(function(a){a.widget("ui.autocomplete",{options:{minLength:1,delay:300},_create:function(){var d=this,b=this.element[0].ownerDocument;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(b){var e=a.ui.keyCode;switch(b.keyCode){case e.PAGE_UP:d._move("previousPage",b);break;case e.PAGE_DOWN:d._move("nextPage",b);break;case e.UP:d._move("previous",b);b.preventDefault();
break;case e.DOWN:d._move("next",b);b.preventDefault();break;case e.ENTER:case e.NUMPAD_ENTER:d.menu.active&&b.preventDefault();case e.TAB:if(!d.menu.active)break;d.menu.select(b);break;case e.ESCAPE:d.element.val(d.term);d.close(b);break;case e.LEFT:case e.RIGHT:case e.SHIFT:case e.CONTROL:case e.ALT:case e.COMMAND:case e.COMMAND_RIGHT:case e.INSERT:case e.CAPS_LOCK:case e.END:case e.HOME:break;default:clearTimeout(d.searching),d.searching=setTimeout(function(){d.search(null,b)},d.options.delay)}}).bind("focus.autocomplete",
function(){d.selectedItem=null;d.previous=d.element.val()}).bind("blur.autocomplete",function(a){clearTimeout(d.searching);d.closing=setTimeout(function(){d.close(a);d._change(a)},150)});this._initSource();this.response=function(){return d._response.apply(d,arguments)};this.menu=a("<ul></ul>").addClass("ui-autocomplete").appendTo("body",b).mousedown(function(){setTimeout(function(){clearTimeout(d.closing)},13)}).menu({focus:function(a,b){b=b.item.data("item.autocomplete");!1!==d._trigger("focus",
null,{item:b})&&/^key/.test(a.originalEvent.type)&&d.element.val(b.value)},selected:function(a,e){e=e.item.data("item.autocomplete");!1!==d._trigger("select",a,{item:e})&&d.element.val(e.value);d.close(a);a=d.previous;d.element[0]!==b.activeElement&&(d.element.focus(),d.previous=a);d.selectedItem=e},blur:function(){d.menu.element.is(":visible")&&d.element.val(d.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu");a.fn.bgiframe&&this.menu.element.bgiframe()},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");
this.menu.element.remove();a.Widget.prototype.destroy.call(this)},_setOption:function(d){a.Widget.prototype._setOption.apply(this,arguments);"source"===d&&this._initSource()},_initSource:function(){var d,b;a.isArray(this.options.source)?(d=this.options.source,this.source=function(b,e){e(a.ui.autocomplete.filter(d,b.term))}):"string"===typeof this.options.source?(b=this.options.source,this.source=function(c,e){a.getJSON(b,c,e)}):this.source=this.options.source},search:function(a,b){a=null!=a?a:this.element.val();
if(a.length<this.options.minLength)return this.close(b);clearTimeout(this.closing);if(!1!==this._trigger("search"))return this._search(a)},_search:function(a){this.term=this.element.addClass("ui-autocomplete-loading").val();this.source({term:a},this.response)},_response:function(a){a.length?(a=this._normalize(a),this._suggest(a),this._trigger("open")):this.close();this.element.removeClass("ui-autocomplete-loading")},close:function(a){clearTimeout(this.closing);this.menu.element.is(":visible")&&(this._trigger("close",
a),this.menu.element.hide(),this.menu.deactivate())},_change:function(a){this.previous!==this.element.val()&&this._trigger("change",a,{item:this.selectedItem})},_normalize:function(d){return d.length&&d[0].label&&d[0].value?d:a.map(d,function(b){return"string"===typeof b?{label:b,value:b}:a.extend({label:b.label||b.value,value:b.value||b.label},b)})},_suggest:function(a){var b=this.menu.element.empty().zIndex(this.element.zIndex()+1),c;this._renderMenu(b,a);this.menu.deactivate();this.menu.refresh();
this.menu.element.show().position({my:"left top",at:"left bottom",of:this.element,collision:"none"});a=b.width("").width();c=this.element.width();b.width(Math.max(a,c))},_renderMenu:function(d,b){var c=this;a.each(b,function(a,b){c._renderItem(d,b)})},_renderItem:function(d,b){return a("<li></li>").data("item.autocomplete",b).append("<a>"+b.label+"</a>").appendTo(d)},_move:function(a,b){if(this.menu.element.is(":visible"))if(this.menu.first()&&/^previous/.test(a)||this.menu.last()&&/^next/.test(a))this.element.val(this.term),
this.menu.deactivate();else this.menu[a](b);else this.search(null,b)},widget:function(){return this.menu.element}});a.extend(a.ui.autocomplete,{escapeRegex:function(a){return a.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")},filter:function(d,b){var c=RegExp(a.ui.autocomplete.escapeRegex(b),"i");return a.grep(d,function(a){return c.test(a.label||a.value||a)})}})})(jQuery);
(function(a){a.widget("ui.menu",{_create:function(){var d=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(b){a(b.target).closest(".ui-menu-item a").length&&(b.preventDefault(),d.select(b))});this.refresh()},refresh:function(){var d=this;this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem").children("a").addClass("ui-corner-all").attr("tabindex",
-1).mouseenter(function(b){d.activate(b,a(this).parent())}).mouseleave(function(){d.deactivate()})},activate:function(a,b){this.deactivate();if(this.hasScroll()){var c=b.offset().top-this.element.offset().top,e=this.element.attr("scrollTop"),h=this.element.height();0>c?this.element.attr("scrollTop",e+c):c>h&&this.element.attr("scrollTop",e+c-h+b.height())}this.active=b.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end();this._trigger("focus",a,{item:b})},deactivate:function(){this.active&&
(this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null)},next:function(a){this.move("next",".ui-menu-item:first",a)},previous:function(a){this.move("prev",".ui-menu-item:last",a)},first:function(){return this.active&&!this.active.prev().length},last:function(){return this.active&&!this.active.next().length},move:function(a,b,c){this.active?(a=this.active[a+"All"](".ui-menu-item").eq(0),a.length?this.activate(c,a):this.activate(c,this.element.children(b))):
this.activate(c,this.element.children(b))},nextPage:function(d){if(this.hasScroll())if(!this.active||this.last())this.activate(d,this.element.children(":first"));else{var b=this.active.offset().top,c=this.element.height(),e=this.element.children("li").filter(function(){var e=a(this).offset().top-b-c+a(this).height();return 10>e&&-10<e});e.length||(e=this.element.children(":last"));this.activate(d,e)}else this.activate(d,this.element.children(!this.active||this.last()?":first":":last"))},previousPage:function(d){if(this.hasScroll())if(!this.active||
this.first())this.activate(d,this.element.children(":last"));else{var b=this.active.offset().top,c=this.element.height();result=this.element.children("li").filter(function(){var e=a(this).offset().top-b+c-a(this).height();return 10>e&&-10<e});result.length||(result=this.element.children(":first"));this.activate(d,result)}else this.activate(d,this.element.children(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element.attr("scrollHeight")},select:function(a){this._trigger("selected",
a,{item:this.active})}})})(jQuery);(function(a){a.iButton={version:"1.0.03",setDefaults:function(b){a.extend(c,b)}};a.fn.iButton=function(e){var c="string"==typeof arguments[0]&&arguments[0],d=c&&Array.prototype.slice.call(arguments,1)||arguments,h=0==this.length?null:a.data(this[0],"iButton");if(h&&c&&this.length){if("object"==c.toLowerCase())return h;if(h[c]){var k;this.each(function(b){var e=a.data(this,"iButton")[c].apply(h,d);if(0==b&&e)if(e.jquery)k=a([]).add(e);else return k=e,!1;else e&&e.jquery&&(k=k.add(e))});return k||this}return this}return this.each(function(){new b(this,
e)})};var d=0;a.browser.iphone=-1<navigator.userAgent.toLowerCase().indexOf("iphone");var b=function(b,g){var j=this,i=a(b),k=++d,n=!1,p,u,s,z=!1,v=null,q=null,m=null,B=null,g=a.extend({},c,g,a.metadata?i.metadata():{});s=g.labelOn==e&&g.labelOff==h;if(i.is(":checkbox, :radio")){if(a.data(i[0],"iButton"))return}else return i.find(":checkbox, :radio").iButton(g);a.data(i[0],"iButton",j);"auto"==g.resizeHandle&&(g.resizeHandle=!s);"auto"==g.resizeContainer&&(g.resizeContainer=!s);this.toggle=function(a){i.attr("checked",
arguments.length>0?a:!i[0].checked).trigger("change")};this.disable=function(b){var e=arguments.length>0?b:!n;n=e;i.attr("disabled",e);o[e?"addClass":"removeClass"](g.classDisabled);a.isFunction(g.disable)&&g.disable.apply(j,[n,i,g])};this.repaint=function(){t()};this.destroy=function(){a([i[0],o[0]]).unbind(".iButton");a(document).unbind(".iButton_"+k);o.after(i).remove();a.data(i[0],"iButton",null);a.isFunction(g.destroy)&&g.destroy.apply(j,[i,g])};i.wrap('<div class="'+a.trim(g.classContainer+
" "+g.className)+'" />').after('<div class="'+g.classHandle+'"><div class="'+g.classHandleRight+'"><div class="'+g.classHandleMiddle+'" /></div></div><div class="'+g.classLabelOff+'"><span><label>'+g.labelOff+'</label></span></div><div class="'+g.classLabelOn+'"><span><label>'+g.labelOn+'</label></span></div><div class="'+g.classPaddingLeft+'"></div><div class="'+g.classPaddingRight+'"></div>');var o=i.parent(),r=i.siblings("."+g.classHandle),C=i.siblings("."+g.classLabelOff),w=C.children("span"),
x=i.siblings("."+g.classLabelOn),y=x.children("span");if(g.resizeHandle||g.resizeContainer)p=y.outerWidth(),u=w.outerWidth();g.resizeHandle?(s=Math.min(p,u),r.css("width",s)):s=r.width();g.resizeContainer?(p=Math.max(p,u)+s+20,o.css("width",p),C.css("width",p-5)):p=o.width();var l=p-s-6,t=function(a){var b=i[0].checked?l:0;if((a=arguments.length>0?arguments[0]:true)&&g.enableFx){r.stop().animate({left:b},g.duration,g.easing);x.stop().animate({width:b+4},g.duration,g.easing);y.stop().animate({marginLeft:b-
l},g.duration,g.easing);w.stop().animate({marginRight:-b},g.duration,g.easing)}else{r.css("left",b);x.css("width",b+4);y.css("marginLeft",b-l);w.css("marginRight",-b)}};t(!1);var A=function(a){return a.pageX||(a.originalEvent.changedTouches?a.originalEvent.changedTouches[0].pageX:0)};o.bind("mousedown.iButton touchstart.iButton",function(b){if(!a(b.target).is(":checkbox, :radio")&&!(n||!g.allowRadioUncheck&&i.is(":radio:checked"))){b.preventDefault();v=r;q=A(b);m=q-(parseInt(r.css("left"),10)||0);
B=(new Date).getTime();return false}});g.enableDrag&&a(document).bind("mousemove.iButton_"+k+" touchmove.iButton_"+k,function(a){if(v==r){a.preventDefault();a=A(a);if(a!=m){z=true;o.addClass(g.classHandleActive)}a=Math.min(1,Math.max(0,(a-m)/l));r.css("left",a*l);x.css("width",a*l+4);w.css("marginRight",-a*l);y.css("marginLeft",-(1-a)*l);return false}});a(document).bind("mouseup.iButton_"+k+" touchend.iButton_"+k,function(b){if(v!=r)return false;b.preventDefault();var e=true;if(!z||(new Date).getTime()-
B<g.clickOffset){b=i[0].checked;i.attr("checked",!b);a.isFunction(g.click)&&g.click.apply(j,[!b,i,g])}else{b=(A(b)-m)/l>=0.5;i[0].checked==b&&(e=false);i.attr("checked",b)}o.removeClass(g.classHandleActive);z=v=null;e?i.trigger("change"):t();return false});i.bind("change.iButton",function(){t();if(i.is(":radio")){var b=i[0];a(b.form?b.form[b.name]:":radio[name="+b.name+"]").filter(":not(:checked)").iButton("repaint")}a.isFunction(g.change)&&g.change.apply(j,[i,g])}).bind("focus.iButton",function(){o.addClass(g.classFocus)}).bind("blur.iButton",
function(){o.removeClass(g.classFocus)});a.isFunction(g.click)&&i.bind("click.iButton",function(){g.click.apply(j,[i[0].checked,i,g])});i.is(":disabled")&&this.disable(!0);a.browser.msie&&(o.find("*").andSelf().attr("unselectable","on"),i.bind("click.iButton",function(){i.triggerHandler("change.iButton")}));a.isFunction(g.init)&&g.init.apply(j,[i,g])},c={duration:200,easing:"swing",labelOn:"ON",labelOff:"OFF",resizeHandle:"auto",resizeContainer:"auto",enableDrag:!0,enableFx:!0,allowRadioUncheck:!1,
clickOffset:120,className:"",classContainer:"ibutton-container",classDisabled:"ibutton-disabled",classFocus:"ibutton-focus",classLabelOn:"ibutton-label-on",classLabelOff:"ibutton-label-off",classHandle:"ibutton-handle",classHandleMiddle:"ibutton-handle-middle",classHandleRight:"ibutton-handle-right",classHandleActive:"ibutton-active-handle",classPaddingLeft:"ibutton-padding-left",classPaddingRight:"ibutton-padding-right",init:null,change:null,click:null,disable:null,destroy:null},e=c.labelOn,h=c.labelOff})(jQuery);jQuery.fn.farbtastic=function(a){$.farbtastic(this,a);return this};jQuery.farbtastic=function(a,d){a=$(a).get(0);return a.farbtastic||(a.farbtastic=new jQuery._farbtastic(a,d))};
jQuery._farbtastic=function(a,d){var b=this;$(a).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var c=$(".farbtastic",a);b.wheel=$(".wheel",a).get(0);b.radius=84;b.square=100;b.width=194;navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",c).each(function(){if("none"!=this.currentStyle.backgroundImage){var a=this.currentStyle.backgroundImage,a=this.currentStyle.backgroundImage.substring(5,
a.length-2);$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+a+"')"})}});b.linkTo=function(a){"object"==typeof b.callback&&$(b.callback).unbind("keyup",b.updateValue);b.color=null;if("function"==typeof a)b.callback=a;else if("object"==typeof a||"string"==typeof a)b.callback=$(a),b.callback.bind("keyup",b.updateValue),b.callback.get(0).value&&b.setColor(b.callback.get(0).value);return this};b.updateValue=function(){this.value&&
this.value!=b.color&&b.setColor(this.value)};b.setColor=function(a){var c=b.unpack(a);b.color!=a&&c&&(b.color=a,b.rgb=c,b.hsl=b.RGBToHSL(b.rgb),b.updateDisplay());return this};b.setHSL=function(a){b.hsl=a;b.rgb=b.HSLToRGB(a);b.color=b.pack(b.rgb);b.updateDisplay();return this};b.widgetCoords=function(a){var c,d,g=a.target||a.srcElement,j=b.wheel;if("undefined"!=typeof a.offsetX){for(var i={x:a.offsetX,y:a.offsetY},a=g;a;)a.mouseX=i.x,a.mouseY=i.y,i.x+=a.offsetLeft,i.y+=a.offsetTop,a=a.offsetParent;
a=j;for(i=j=0;a;){if("undefined"!=typeof a.mouseX){c=a.mouseX-j;d=a.mouseY-i;break}j+=a.offsetLeft;i+=a.offsetTop;a=a.offsetParent}for(a=g;a;)a.mouseX=void 0,a.mouseY=void 0,a=a.offsetParent}else i=b.absolutePosition(j),c=(a.pageX||0*(a.clientX+$("html").get(0).scrollLeft))-i.x,d=(a.pageY||0*(a.clientY+$("html").get(0).scrollTop))-i.y;return{x:c-b.width/2,y:d-b.width/2}};b.mousedown=function(a){document.dragging||($(document).bind("mousemove",b.mousemove).bind("mouseup",b.mouseup),document.dragging=
!0);var c=b.widgetCoords(a);b.circleDrag=2*Math.max(Math.abs(c.x),Math.abs(c.y))>b.square;b.mousemove(a);return!1};b.mousemove=function(a){var c=b.widgetCoords(a);b.circleDrag?(a=Math.atan2(c.x,-c.y)/6.28,0>a&&(a+=1),b.setHSL([a,b.hsl[1],b.hsl[2]])):(a=Math.max(0,Math.min(1,-(c.x/b.square)+0.5)),c=Math.max(0,Math.min(1,-(c.y/b.square)+0.5)),b.setHSL([b.hsl[0],a,c]));return!1};b.mouseup=function(){$(document).unbind("mousemove",b.mousemove);$(document).unbind("mouseup",b.mouseup);document.dragging=
!1};b.updateDisplay=function(){var a=6.28*b.hsl[0];$(".h-marker",c).css({left:Math.round(Math.sin(a)*b.radius+b.width/2)+"px",top:Math.round(-Math.cos(a)*b.radius+b.width/2)+"px"});$(".sl-marker",c).css({left:Math.round(b.square*(0.5-b.hsl[1])+b.width/2)+"px",top:Math.round(b.square*(0.5-b.hsl[2])+b.width/2)+"px"});$(".color",c).css("backgroundColor",b.pack(b.HSLToRGB([b.hsl[0],1,0.5])));"object"==typeof b.callback?($(b.callback).css({backgroundColor:b.color,color:0.5<b.hsl[2]?"#000":"#fff"}),$(b.callback).each(function(){this.value&&
this.value!=b.color&&(this.value=b.color)})):"function"==typeof b.callback&&b.callback.call(b,b.color)};b.absolutePosition=function(a){var c={x:a.offsetLeft,y:a.offsetTop};a.offsetParent&&(a=b.absolutePosition(a.offsetParent),c.x+=a.x,c.y+=a.y);return c};b.pack=function(a){var b=Math.round(255*a[0]),c=Math.round(255*a[1]),a=Math.round(255*a[2]);return"#"+(16>b?"0":"")+b.toString(16)+(16>c?"0":"")+c.toString(16)+(16>a?"0":"")+a.toString(16)};b.unpack=function(a){if(7==a.length)return[parseInt("0x"+
a.substring(1,3))/255,parseInt("0x"+a.substring(3,5))/255,parseInt("0x"+a.substring(5,7))/255];if(4==a.length)return[parseInt("0x"+a.substring(1,2))/15,parseInt("0x"+a.substring(2,3))/15,parseInt("0x"+a.substring(3,4))/15]};b.HSLToRGB=function(a){var b,c=a[0];b=a[1];a=a[2];b=0.5>=a?a*(b+1):a+b-a*b;a=2*a-b;return[this.hueToRGB(a,b,c+0.33333),this.hueToRGB(a,b,c),this.hueToRGB(a,b,c-0.33333)]};b.hueToRGB=function(a,b,c){c=0>c?c+1:1<c?c-1:c;return 1>6*c?a+6*(b-a)*c:1>2*c?b:2>3*c?a+6*(b-a)*(0.66666-c):
a};b.RGBToHSL=function(a){var b,c,d,j,i=a[0],k=a[1],n=a[2];b=Math.min(i,Math.min(k,n));a=Math.max(i,Math.max(k,n));c=a-b;j=(b+a)/2;d=0;0<j&&1>j&&(d=c/(0.5>j?2*j:2-2*j));b=0;0<c&&(a==i&&a!=k&&(b+=(k-n)/c),a==k&&a!=n&&(b+=2+(n-i)/c),a==n&&a!=i&&(b+=4+(i-k)/c),b/=6);return[b,d,j]};$("*",c).mousedown(b.mousedown);b.setColor("#000000");d&&b.linkTo(d)};(function(a){var d=[],b=[];a.fn.doAutosize=function(b){var e=a(this).data("minwidth"),d=a(this).data("maxwidth"),f="",g=a(this),j=a("#"+a(this).data("tester_id"));if(f!==(f=g.val()))f=f.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">"),j.html(f),j=j.width(),b=j+b.comfortZone>=e?j+b.comfortZone:e,j=g.width(),(b<j&&b>=e||b>e&&b<d)&&g.width(b)};a.fn.resetAutosize=function(b){var e=a(this).data("minwidth")||b.minInputWidth||a(this).width(),b=a(this).data("maxwidth")||b.maxInputWidth||
a(this).closest(".tagsinput").width()-b.inputPadding,d=a(this),f=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:d.css("fontSize"),fontFamily:d.css("fontFamily"),fontWeight:d.css("fontWeight"),letterSpacing:d.css("letterSpacing"),whiteSpace:"nowrap"}),g=a(this).attr("id")+"_autosize_tester";0<!a("#"+g).length&&(f.attr("id",g),f.appendTo("body"));d.data("minwidth",e);d.data("maxwidth",b);d.data("tester_id",g);d.css("width",e)};a.fn.addTag=function(c,e){e=jQuery.extend({focus:!1,
callback:!0},e);this.each(function(){var h=a(this).attr("id"),f=a(this).val().split(d[h]);""==f[0]&&(f=[]);c=jQuery.trim(c);var g;e.unique?(g=a(f).tagExist(c),!0==g&&a("#"+h+"_tag").addClass("not_valid")):g=!1;if(""!=c&&!0!=g&&(a("<span>").addClass("tag").append(a("<span>").text(c).append("\u00a0\u00a0"),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+h).removeTag(escape(c))})).insertBefore("#"+h+"_addTag"),f.push(c),a("#"+h+"_tag").val(""),e.focus?a("#"+h+"_tag").focus():
a("#"+h+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,f),e.callback&&(b[h]&&b[h].onAddTag)&&(g=b[h].onAddTag,g.call(this,c)),b[h]&&b[h].onChange)){var j=f.length;g=b[h].onChange;g.call(this,a(this),f[j-1])}});return!1};a.fn.removeTag=function(c){c=unescape(c);this.each(function(){var e=a(this).attr("id"),h=a(this).val().split(d[e]);a("#"+e+"_tagsinput .tag").remove();str="";for(var f=0;f<h.length;f++)h[f]!=c&&(str=str+d[e]+h[f]);a.fn.tagsInput.importTags(this,str);b[e]&&b[e].onRemoveTag&&b[e].onRemoveTag.call(this,
c)});return!1};a.fn.tagExist=function(b){return 0<=jQuery.inArray(b,a(this))};a.fn.importTags=function(b){id=a(this).attr("id");a("#"+id+"_tagsinput .tag").remove();a.fn.tagsInput.importTags(this,b)};a.fn.tagsInput=function(c){var e=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},c);this.each(function(){e.hide&&
a(this).hide();var c=a(this).attr("id"),f=jQuery.extend({pid:c,real_input:"#"+c,holder:"#"+c+"_tagsinput",input_wrapper:"#"+c+"_addTag",fake_input:"#"+c+"_tag"},e);d[c]=f.delimiter;if(e.onAddTag||e.onRemoveTag||e.onChange)b[c]=[],b[c].onAddTag=e.onAddTag,b[c].onRemoveTag=e.onRemoveTag,b[c].onChange=e.onChange;var g='<div id="'+c+'_tagsinput" class="tagsinput"><div id="'+c+'_addTag">';e.interactive&&(g=g+'<input id="'+c+'_tag" value="" data-default="'+e.defaultText+'" />');a(g+'</div><div class="tags_clear"></div></div>').insertAfter(this);
a(f.holder).css("width",e.width);a(f.holder).css("height",e.height);""!=a(f.real_input).val()&&a.fn.tagsInput.importTags(a(f.real_input),a(f.real_input).val());if(e.interactive){a(f.fake_input).val(a(f.fake_input).attr("data-default"));a(f.fake_input).css("color",e.placeholderColor);a(f.fake_input).resetAutosize(e);a(f.holder).bind("click",f,function(b){a(b.data.fake_input).focus()});a(f.fake_input).bind("focus",f,function(b){a(b.data.fake_input).val()==a(b.data.fake_input).attr("data-default")&&
a(b.data.fake_input).val("");a(b.data.fake_input).css("color","#000000")});if(void 0!=e.autocomplete_url){autocomplete_options={source:e.autocomplete_url};for(attrname in e.autocomplete)autocomplete_options[attrname]=e.autocomplete[attrname];void 0!==jQuery.Autocompleter?(a(f.fake_input).autocomplete(e.autocomplete_url,e.autocomplete),a(f.fake_input).bind("result",f,function(b,d){d&&a("#"+c).addTag(d[0]+"",{focus:!0,unique:e.unique})})):void 0!==jQuery.ui.autocomplete&&(a(f.fake_input).autocomplete(autocomplete_options),
a(f.fake_input).bind("autocompleteselect",f,function(b,c){a(b.data.real_input).addTag(c.item.value,{focus:!0,unique:e.unique});return!1}))}else a(f.fake_input).bind("blur",f,function(b){var c=a(this).attr("data-default");""!=a(b.data.fake_input).val()&&a(b.data.fake_input).val()!=c?b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:e.unique}):(a(b.data.fake_input).val(a(b.data.fake_input).attr("data-default")),
a(b.data.fake_input).css("color",e.placeholderColor));return!1});a(f.fake_input).bind("keypress",f,function(b){if(b.which==b.data.delimiter.charCodeAt(0)||13==b.which)return b.preventDefault(),b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:e.unique}),a(b.data.fake_input).resetAutosize(e),!1;b.data.autosize&&a(b.data.fake_input).doAutosize(e)});f.removeWithBackspace&&
a(f.fake_input).bind("keydown",function(b){if(8==b.keyCode&&""==a(this).val()){b.preventDefault();var b=a(this).closest(".tagsinput").find(".tag:last").text(),c=a(this).attr("id").replace(/_tag$/,""),b=b.replace(/[\s]+x$/,"");a("#"+c).removeTag(escape(b));a(this).trigger("focus")}});a(f.fake_input).blur();f.unique&&a(f.fake_input).keydown(function(b){(8==b.keyCode||String.fromCharCode(b.which).match(/\w+|[\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\u00f1\u00d1,\/]+/))&&a(this).removeClass("not_valid")})}return!1});
return this};a.fn.tagsInput.updateTagsField=function(b,e){var h=a(b).attr("id");a(b).val(e.join(d[h]))};a.fn.tagsInput.importTags=function(c,e){a(c).val("");for(var h=a(c).attr("id"),f=e.split(d[h]),g=0;g<f.length;g++)a(c).addTag(f[g],{focus:!1,callback:!1});b[h]&&b[h].onChange&&b[h].onChange.call(c,c,f[g])}})(jQuery);(function(a){function d(b){var e=a(window),d=e.scrollTop(),f=e.scrollLeft()+e.width(),g=e.scrollTop()+e.height(),e=e.scrollLeft(),j=b.element.offset();j.right=j.left+b.element.outerWidth();j.bottom=j.top+b.element.outerHeight();return d<=j.top&&e<=j.left&&f>=j.right&&g>=j.bottom}function b(b,e){return b.clone().addClass(e.fixed_class||"sticky-fixed").css(a.extend({position:"fixed",display:"none"},e.fixed_css||{})).removeAttr("id").insertAfter(b)}a.fn.sticky=function(c){function e(){h.closest("body").length?
a.each(g,function(a,b){f.isStaticVisible.call(b.element,b,f)?b.is_fixed&&(b.is_fixed=!1,b.fixed_clone.hide(),f.hideFixed&&f.hideFixed.call(b.fixed_clone,b,f)):(b.is_fixed||(b.is_fixed=!0,b.fixed_clone.show(),f.showFixed&&f.showFixed.call(b.fixed_clone,b,f)),f.updateFixed&&f.updateFixed.call(b.fixed_clone,b,f))}):a(window).off("resize scroll",e)}var h=this,f=a.extend({fixed_css:{bottom:0},fixed_class:"sticky-fixed",isStaticVisible:d,getClone:b,showFixed:function(a){var b={"min-height":a.element.height(),
"min-width":a.element.width()};a.element.css(b);a.fixed_clone.empty().css(b).append(a.element.children())},hideFixed:function(a){a.element.css({"min-height":0,"min-width":0});a.fixed_clone.children().appendTo(a.element)}},c||{}),g=h.map(function(){var b=a(this);return{element:b,fixed_clone:f.getClone.call(b,b,f),is_fixed:!1}}).get();a(window).on("resize scroll",e);e();return this}})(jQuery);(function(a){a.fn.lazyLoad=function(d){function b(){if(c.stopped)this.onscroll=null;else if(!c.stopped&&!c.loading&&g(h,e)<=c.distance){if(null!==c.hash){var a=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===c.hash.indexOf(a)){this.onscroll=null;return}}c.load()}}if("stop"==d){var c=this.data("lazyLoadSettings");c&&(c.stopped=!0)}else if("sleep"==d){if(c=this.data("lazyLoadSettings"))c.loading=!0}else if("wake"==d){if(c=this.data("lazyLoadSettings"))c.loading=!1}else if("force"==d)(c=
this.data("lazyLoadSettings"))&&(c.loading||c.load());else{this.data("lazyLoadSettings",a.extend({distance:50,load:function(){},container:h,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},d||{}));c=this.data("lazyLoadSettings");c.loading=!1;c.stopped=!1;var e=this,h="string"===typeof c.container?a(c.container):c.container;null!==c.hash&&!a.isArray(c.hash)&&(c.hash=[c.hash]);a.fn.lazyLoad.call(e,c.state);var f=setTimeout(function(){if(c.stopped)clearTimeout(f);
else{if(c.hash!==null){var a=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(c.hash.indexOf(a)===-1){clearTimeout(f);return}}if(c.loading)f=setTimeout(arguments.callee,350);else{g(h,e);if(g(h,e)<=c.distance){c.load();f=setTimeout(arguments.callee,350)}else{e.get(0).onscroll=b;clearTimeout(f)}}}},350),g="function"===typeof c.distanceBetweenBottoms?c.distanceBetweenBottoms:function(a,b,c){return a.position().top+a.outerHeight()-(c||0)-(b.scrollTop()+b.height())}}}})(jQuery);(function(a){function d(b,c){var e=a("#content .tabs");e.find(".selected").removeClass("selected");e.find('a[href="#/'+(b?b+"/":"")+(c?c+"/":"")+'"]').parent().addClass("selected")}a("#topic-access-toggle").iButton({labelOn:"",labelOff:"",className:"mini"});a.storage=new a.store;a.hub={options:{accountName:""},init:function(b){this.options=b||{};a.sidebar.init();"undefined"!=typeof a.History&&(a.History.bind(a.hub.dispatch),a.History.unbind=function(b,e){e?a.History.handlers.specific[b]&&a.each(a.History.handlers.specific[b],
function(d,f){if(f===e)return a.History.handlers.specific[b].splice(d,1),!1}):(e=b,a.each(a.History.handlers.generic,function(b,c){if(c===e)return a.History.handlers.generic.splice(b,1),!1}))});b=window.location.hash;("#/"===b||!b)&&this.dispatch()},forceHash:function(b){b=a.hub.helper.cleanHash(b);a.hub.currentHash!==b&&(a.hub.currentHash=b,window.location.hash=b)},backWithoutDispatch:function(b){var c;b&&a.History.bind(c=function(){a.History.unbind(c);b()});this.skipDispatch=1;history.back()},redispatch:function(){this.currentHash=
null;this.dispatch()},skipDispatch:0,currentHash:null,dispatch:function(b){if(this!==a.hub)return a.hub.dispatch(b);if(0<a.hub.skipDispatch)return a.hub.skipDispatch--,!1;b=a.hub.helper.cleanHash(b||void 0);if(a.hub.currentHash!=b){var c=a.hub.currentHash;a.hub.currentHash=b;var e=new a.Event("wa_before_dispatched");a(window).trigger(e);if(e.isDefaultPrevented())return a.hub.currentHash=c,window.location.hash=c,!1;if(b)if(b=b.replace(/^.*#\/?/,"").replace(/\/$/,""),b=b.split("/"),b[0]){for(var c=
"",e=b.length,d=0;d<b.length;d++){var f=b[d];if(2>d)if(0===d)c=f;else if("add"==f||parseInt(f,10)!=f&&-1==f.indexOf("=")&&"search"!=c&&"following"!=c)c+=f.substr(0,1).toUpperCase()+f.substr(1);else{e=d;break}else{e=d;break}}e=b.slice(e);a.hub[c+"Action"]?(a("#wa-app > .sidebar li.selected").removeClass("selected"),d=a('#wa-app > .sidebar li a[href="#/'+b.join("/")+'/"]'),!d.length&&2<b.length&&(d=a('#wa-app > .sidebar li a[href="#/'+b.slice(0,-1).join("/")+'/"]')),d.length&&d.parent().addClass("selected"),
a.hub.currentAction=c,a.hub.currentActionAttr=e,a.hub[c+"Action"].apply(a.hub,e),a("body").animate({scrollTop:0},200)):console&&console.log("Invalid action name:",c+"Action")}else a.hub.defaultAction();else a.hub.defaultAction()}},defaultAction:function(b){a("#wa-app > .sidebar li.selected").removeClass("selected");a('#wa-app > .sidebar li a[href="#/"]').parent().addClass("selected");b=this.getOrder("default",b);this.load("?module=topics"+(b?"&sort="+b:""),function(){d("",b)})},getOrder:function(b,
c){b="hub/"+b+"/order";return c?(a.storage.set(b,c),c):a.storage.get(b)},initLazyLoad:function(){var b=a(".lazyloading-paging");if(b.length){var c=parseInt(b.data("times"),10),e=b.data("linkText")||"Load more",d=b.find("li.selected");if("1"==d.children("a").text()){b.hide();var f=a(window);f.lazyLoad("stop");d.next().length&&f.lazyLoad({container:"#h-content .h-topics",load:function(){f.lazyLoad("sleep");var b=a(".lazyloading-paging").hide(),d=a(".h-footer"),h=b.find("li.selected").next().find("a").attr("href");
if(h){var k=a("#h-content .h-topics");a.get(h,function(h){h=a("<div></div>").html(h);k.append(h.find("#h-content .h-topics").children());var i=h.find(".lazyloading-paging").hide();b.replaceWith(i);b=i;d.replaceWith(h.find(".h-footer"));c-=1;b.find("li.selected").next().length?!isNaN(c)&&0>=c?(f.lazyLoad("sleep"),a(".lazyloading-load-more").length||a('<a href="#" class="lazyloading-load-more">'+e+"</a>").insertAfter(b).click(function(){c=1;f.lazyLoad("wake");f.lazyLoad("force");return!1})):f.lazyLoad("wake"):
f.lazyLoad("stop");h.remove()})}else f.lazyLoad("stop")}})}}},popularAction:function(){this.defaultAction("popular")},archiveAction:function(){this.defaultAction("archive")},updatedAction:function(){this.defaultAction("updated")},recentAction:function(){this.defaultAction("recent")},unansweredAction:function(){this.defaultAction("unanswered")},contactAction:function(b,c,e){(e=e||"")&&(e="&sort="+e);(c=c||"")&&(c="&hub_id="+c);this.load("?module=topics"+e+c+"&hash=contact/"+encodeURIComponent(b),function(){d("");
a(".h-header .h-sort").remove()})},load:function(b,c){var d=this.options;a("#content").load(b,function(){var b=a("#content").find("h1:first");b.length&&(b=b.children().length?b.find(".title").length?b.find(".title").text():b.contents()[0].textContent?b.contents()[0].textContent:b.contents()[0].innerText:b.text(),document.title=b+" \u2014 "+d.accountName);if(c)try{c.call(this)}catch(f){}})},typeAction:function(a,c){this.load("?module=topics&hash=type/"+a+(c?"&sort="+c:""),function(){})},hubAction:function(a,
c){c=this.getOrder("hub"+a,c);this.load("?module=topics&hash=hub/"+a+(c?"&sort="+c:""))},followingAction:function(a){a=this.getOrder("following",a);this.load("?module=topics&hash=following"+(a?"&sort="+a:""),function(){})},categoryAddAction:function(a){var c=this,a=parseInt(a);this.load("?module=settings&action=category&hub_id="+a,function(){d("category/add/"+a);c.streamSettingsHandler(null,null,"category")})},categoryAction:function(b,c,e){var h=this;this.load("?module=topics&hash=category/"+b+(c?
"&sort="+c:""),function(){d("category/"+b,c);e&&"function"==typeof e&&e();a("a.stream-edit").click(function(){var c=a(this);c.find(".icon16").removeClass("settings").addClass("loading");a("#h-stream-settings").load("?module=settings&action=category&id="+b,function(){h.streamSettingsHandler(b,c,"category")});return!1});var f=a("ul.h-topics.featured");f.sortable({update:function(c,d){var e=a(d.item),f=e.next();a.post("?module=topics&action=move",{id:e.data("id"),before_id:f.length?f.data("id"):null,
category_id:b})}});a("ul.h-topics").on("click","a.topic-featured",function(){var c=a(this),d=a(this).find("i").hasClass("star"),e=a(this).closest("li"),h=e.data("id");a.post("?module=topics&action=setFeatured",{id:h,category_id:b,featured:d?0:1},function(){d?(c.find("i").removeClass("star").addClass("star-empty"),f.find("li[data-id="+h+"]").remove()):(c.find("i").addClass("star").removeClass("star-empty"),f.append("<li data-id="+h+'><i class="icon16 star" title="Featured topic"></i><a href="#/topic/'+
h+'/" class="bold">'+e.find("a:first").text()+'</a><span class="status"></span></li>'))},"json");return!1})})},filterAddAction:function(){var a=this;this.load("?module=settings&action=filter",function(){d("filter/add");a.streamSettingsHandler(null,null,"filter")})},filterAction:function(b,c,e){var h=this,c=this.getOrder("filter"+b,c);this.load("?module=topics&hash=filter/"+b+(c?"&sort="+c:""),function(){d("filter/"+b,c);e&&"function"==typeof e&&e();a("a.stream-edit").click(function(){var c=a(this);
c.find(".icon16").removeClass("funnel").addClass("loading");a("#h-stream-settings").load("?module=settings&action=filter&id="+b,function(){h.streamSettingsHandler(b,c,"filter")});return!1})})},tagAction:function(a,c){this.load("?module=topics&hash=tag/"+a+(c?"&sort="+c:""),function(){d("tag/"+a,c)})},searchAction:function(a){this.load("?module=topics&hash=search/"+encodeURIComponent(a),function(){d("")})},topicAddAction:function(){this.load("?module=topics&action=edit")},topicEditAction:function(a){this.load("?module=topics&action=edit&id="+
a)},topicAction:function(a){this.load("?module=topics&action=info&id="+a)},settingsAction:function(){this.load("?module=settings")},authorsAction:function(){this.load("?module=authors")},settingsTypeAction:function(a){this.load("?module=settings&action=type&id="+a)},settingsHubAction:function(a){this.load("?module=settings&action=hub&id="+a)},settingsFilterAction:function(a){this.load("?module=settings&action=filter&id="+a)},commentsAction:function(){this.load("?module=comments")},pagesAction:function(b){a("#wa-page-container").length?
waLoadPage(b):this.load("?module=pages")},designAction:function(b){b?a("#wa-design-container").length?waDesignLoad():a("#content").load("?module=design",function(){waDesignLoad(b)}):a("#content").load("?module=design",function(){waDesignLoad("")})},designThemesAction:function(){a("#wa-design-container").length?waDesignLoad():a("#content").load("?module=design",function(){waDesignLoad()})},streamSettingsSaveHandler:function(b,c,d,h,f,g){d.find(":submit").attr("disabled",null);if("ok"==b.status){if(c.slideUp(),
g&&(g.find(".icon16").removeClass("loading").addClass("category"==f?"settings":"funnel"),g.show()),b.data){b=b.data||{};switch(f){case "category":a.hub.helper.updateCategory(h||b.id,b);break;case "filter":a.hub.helper.updateFilter(h||b.id,b)}if(h)switch(a(".h-saved").slideDown(),c=function(){a(".h-saved").show();setTimeout(function(){a(".h-saved").slideUp()},4E3)},f){case "category":0<b.type&&a.hub.categoryAction(h,null,c);break;case "filter":a.hub.filterAction(h,null,c)}else window.location.hash=
"/"+f+"/"+b.id+"/"}}else a.hub.helper.formError(d,b.errors||{},"category")},streamDeleteHandler:function(b,c,d){d?"string"==typeof d&&(d+="&id="+b):d={id:b};a.post("?module=settings&action="+c+"Delete",d,function(d){if("ok"==d.status){switch(c){case "category":d=a.sidebar.sidebar.find("#category-"+b);d.next().remove();d.remove();break;case "filter":a.sidebar.sidebar.find('a[href="\\#/filter/'+b+'/"]').parents("li").remove()}location.hash="#/"}},"json")},streamSettingsHandler:function(b,c,d){c&&c.hide();
var h=a("#h-stream-settings");h.slideDown();var f=this,g=h.find("form");this.helper.glyphHandler(g,d,"filter"==d?"icon":"glyph");g.find(':input[name$="\\[name\\]"]:first').focus();g.submit(function(){a.hub.helper.formError(g);g.find(":submit").attr("disabled",!0);a(".tagsinput input").trigger(jQuery.Event("keypress",{which:13}));var j=new FormData(this),i=g.find("#h-category-logo-progressbar"),k=setTimeout(function(){g.find(".progressbar").show()},2E3);a.ajax({url:g.attr("action"),type:"POST",async:!0,
xhr:function(){var b=a.ajaxSettings.xhr();b.upload&&g.find(':input[type="file"]').length&&b.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=a.loaded||a.position,a=a.totalSize||a.total;i.show();i.css("width",Math.min(100,Math.floor(100*(b/a)))+"%")}},!1);return b},success:function(i){try{clearTimeout(k);g.find(".progressbar").hide();var j=a.parseJSON(i);f.streamSettingsSaveHandler(j,h,g,b,d,c||!1)}catch(u){a.hub.helper.formError(g,{submit:i.replace(/<\/?[^>]+>/gi,"").substr(0,
512)},"category")}},data:j,cache:!1,contentType:!1,processData:!1});return!1});a("a.cancel",h).click(function(){h.slideUp();c?(c.find(".icon16").removeClass("loading").addClass("category"==d?"settings":"funnel"),c.show()):window.location.hash="/";return!1});b&&a("a.js-delete",h).click(function(){var c=a(this);if("category"==d&&c.hasClass("js-dialog")){var h=a("#h-category-delete");h.waDialog({onSubmit:function(){f.streamDeleteHandler(b,d,h.find("form").serialize());return!1}})}else confirm($_("Are you sure?"))&&
f.streamDeleteHandler(b,d);return!1})},manageHandler:function(){a("#blog-stream-primary-menu").hide();a("#blog-stream-manage-menu").show();this.management=!0;this.onContentUpdate();return!1},manageCompleteHandler:function(){this.management=!1;a("#blog-stream-manage-menu").hide();a("#blog-stream-primary-menu").show();a(".b-post.js-managed").each(function(){a(this).removeClass("js-managed");a(this).find("h3:hidden").show();a(this).find("h3:first").hide();a(this).find(".b-post-body:hidden, .profile.image20px:hidden").fadeIn()});
return!1},topics:{$topics_ul:null,$bulk_menu:null,$sort_menu:null,init:function(b){if(b&&"undefined"!=typeof b.topics_count){var c=a("#wa-app > .sidebar li.selected:first .count:first");c.length&&c.text(b.topics_count)}this.$topics_ul=a("ul.h-topics");this.$bulk_menu=a("ul.js-bulk-menu:first");this.$sort_menu=a("ul.js-sort-menu:first");var d=this;this.$bulk_menu.find("a:first").click(function(){a(this).is(":visible")&&d.$topics_ul.addClass("h-bulk-mode");d.$sort_menu.hide();d.$bulk_menu.find("li").toggle();
d.bulkCount();return!1});this.$bulk_menu.find("a:last").click(function(){a(this).is(":visible")&&d.$topics_ul.removeClass("h-bulk-mode");d.$sort_menu.show();d.$bulk_menu.find("li").toggle();return!1});this.$bulk_menu.find("a.js-bulk-action").click(function(){var b=a(this);if(d.bulkCount()){var c=b.data("confirm");if(!c||confirm(c))c=b.data("action"),c="bulk"+c.substr(0,1).toUpperCase()+c.substr(1),d[c+"Action"].apply(d,[b])}else alert($_("Select at least one topic"));return!1});this.$topics_ul.on("click",
".h-follow",function(){var b=a(this),c=b.find("i"),d=c.hasClass("star-empty")?1:0;a.post("?module=following",{topic_id:b.data("topic"),follow:d},function(e){if("ok"==e.status){var e=parseInt(a("#following-count").html()),i=b.closest("li"),k=i.find(".h-comments");d?(k.slideDown(),i.addClass("h-followed").removeClass("h-not-followed"),b.addClass("highlighted"),c.removeClass("star-empty").addClass("star"),b.find(".followers-count").html($_("Following")),e+=1):(k.slideUp(),i.removeClass("h-followed").addClass("h-not-followed"),
b.removeClass("highlighted"),c.addClass("star-empty").removeClass("star"),b.find(".followers-count").html(""),e-=1);a("#following-count").addClass("highlighted").html(e)}},"json");return!1});this.$topics_ul.on("click",".toggle-comments",function(){a(this).closest("li").find(".h-comments").slideToggle()});this.$topics_ul.on("change",":input.js-bulk-mode",function(){d.bulkCount()})},bulkCount:function(){var a=this.$topics_ul.find(":input.js-bulk-mode:checked").length;this.$bulk_menu.find(".js-count").text(a);
return a},bulkDeleteAction:function(b){b.find("i.icon16").removeClass("delete").addClass("loading");var c=[];this.$topics_ul.find(":input.js-bulk-mode:checked").each(function(){c.push(this.value)});var d=this;a.ajax({url:"?module=topics&action=delete",dataType:"json",type:"post",data:{ids:c},success:function(a){b.find("i.icon16").removeClass("loading").addClass("delete");d.$bulk_menu.find("a:last").click();if("ok"!=a.status)default_error_handler(a);else if(a.data.deleted)for(var c in a.data.deleted)a.data.deleted.hasOwnProperty(c)&&
d.$topics_ul.find('>li[data-id="'+a.data.deleted[c]+'"]').remove()}})},bulkMoveAction:function(b){var b="&hub_id="+b.data("hub")+"&category_id="+b.data("category"),c=a("#h-bulk-topics-move"),d=this;c.hasClass("dialog")?d.bulkMoveDialog(c):c.load("?module=dialog&action=topicsMove"+b,function(){c.addClass("dialog");c.find(':input[name="hub_id"]').change(function(){if(this.checked){c.find("select").attr("disabled",!0);var b=a(this).parents(".value:first").find("select:first");b.length&&b.attr("disabled",
null)}}).change();d.bulkMoveDialog(c)})},bulkMoveDialog:function(b){var c=this;b.waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var a=[];c.$topics_ul.find(":input.js-bulk-mode:checked").each(function(){a.push(this.value)});b.find(':input[name="topic_ids"]').val(a.join(","))},onSubmit:function(){var c=b.find("form:first"),d=c.find(':input[name="hub_id"]:checked'),f=d.val(),g=d.parents(".value:first").find("select:first").val();a.ajax({url:c.attr("action"),data:c.serialize(),dataType:"json",
type:"post",success:function(){b.waDialog("close");window.location.hash=g?"/category/"+g+"/":f?"/hub/"+f+"/":"/"}});return!1}})}},helper:{formError:function(b,c,d){b.find(":submit").attr("disabled",null);if(c){for(var h in c||{})if(c.hasOwnProperty(h)){var f=b.find(this.getSelector(h,d));f.length||(f=b.find(this.getSelector(h)));f.length||(f=b.find(":submit:first"));f.addClass("error");var g=f.next(".errormsg");g.length?g.text(c[h]):f.after(a('<em class="errormsg"></em>').text(c[h]))}b.find("input.error:first").focus()}else b.find(":input.error").removeClass("error"),
b.find(".errormsg").text("")},updateCategory:function(b,c){var d=a.sidebar.sidebar.find("#category-"+b);d.length?(d.find(".count").text(c.topics_count),d.find(".name").text(c.name),d.find(".js-glyph").replaceWith(c.glyph_html),a("h1.list-title .title").text(c.name)):(d=a('<li class="drag-newposition"></li><li class="dr" id="category-'+c.id+'"><span class="count">'+c.topics_count+'</span><a href="#/category/'+c.id+'/">'+c.glyph_html+'<span class="name">name placeholder</span><span class="count"><i class="icon10 add h-new-category" data-category-id="'+
c.id+'"></i></span></a></li>'),a('div.h-hub[data-hub-id="'+c.hub_id+'"] .category-list > ul:first').prepend(d),d.find(".name").text(c.name))},updateFilter:function(b,c){var d=a.sidebar.sidebar.find('a[href="\\#/filter/'+b+'/"]').parents("li");d.length?(d.find(".count").text(c.topics_count),d.find(".name").text(c.name),d.find(".js-icon").replaceWith(c.icon_html),a("h1.list-title .title").text(c.name)):(d=a('<li><a href="#/filter/'+(b||c.id)+'/">'+c.icon_html+'<span class="name">name placeholder</span></a></li>'),
d.insertBefore(a.sidebar.sidebar.find('a[href="\\#/filter/add/"]').parents("li")),d.find(".name").text(c.name))},glyphHandler:function(b,c,d){d||(d="glyph");var h=b.find(".js-"+d+"-templates"),f=b.find(this.getSelector(d,c));h.on("click","li > a",function(){h.find(".selected").removeClass("selected");var b=a(this);b.parents("li").addClass("selected");f.val(b.data(d));return!1})},confirmLeave:function(b,c,d){var h,f,g=a(window);g.on("beforeunload",h=function(){if(b())return c});g.on("wa_before_dispatched",
f=function(a){b()?confirm(c+" "+d)||a.preventDefault():g.off("unload",h).off("wa_before_dispatched",f)})},cleanHash:function(a){"undefined"==typeof a&&(a=window.location.hash.toString());for(a.length||(a=""+a);0<a.length&&"/"===a[a.length-1];)a=a.substr(0,a.length-1);a+="/";"#"!=a[0]?("/"!=a[0]&&(a="/"+a),a="#"+a):a[1]&&"/"!=a[1]&&(a="#/"+a.substr(1));return"#/"==a?"":a},isCtrlS:function(a){return 19==a.which||115==a.which&&a.ctrlKey||"s"==String.fromCharCode(a.which).toLowerCase()&&a.ctrlKey?!0:
!1},getSelector:function(a,c){var d=':input[name="';return c?d+c+"\\["+a+'\\]"]':d+a+'"]'}}}})(jQuery);(function(a){a.sidebar={sidebar:null,options:{},init:function(d){this.options=d||{};this.sidebar=a("#wa-app").find(".sidebar:first");this.initCollapsibleSections();this.initCategoriesDragAndDrop();this.initFiltersDragAndDrop();this.reloader||(this.reloader=setInterval(function(){a.sidebar.reload()},3E5))},initCategoriesDragAndDrop:function(){this.sidebar.find(".category-list ul").sortable({axis:"y",items:"> li",distance:5,update:function(d,b){var c={id:b.item.data("categoryId"),before_id:b.item.prev().data("categoryId")||
0};a.post("?module=categories&action=move",c,null,"json").always(function(a,b){if("success"!=b||"ok"!==a.status)console&&console.log(b,a.errors||a)})}})},initFiltersDragAndDrop:function(){var d=a("#h-sidebar-filters-list"),b={};d.children().each(function(c,d){var f=a(d);b[f.data("filterId")]=f});var c=a.storage.get("hub/filters_order");c&&c.reverse&&a.each(c.reverse(),function(a,c){b[c]&&b[c].prependTo(d)});d.sortable({axis:"y",items:"> li",distance:5,update:function(){var b=[];d.children().each(function(c,
d){b.push(a(d).data("filterId"))});a.storage.set("hub/filters_order",b)}})},initCollapsibleSections:function(){var d=function(b,c){var d="hub/"+a(b).attr("id")+"/collapse",h=a(b).find(".collapse-handler"),f=a(b).next();h.hasClass("darr")?(h.removeClass("darr").addClass("rarr"),f.hide(),c||a.storage.set(d,1)):(h.removeClass("rarr").addClass("darr"),f.show(),c||a.storage.del(d,1));return!1};this.sidebar.on("click",".collapse",function(){d(this)});this.sidebar.find(".collapse").each(function(){var b=
"hub/"+a(this).attr("id")+"/collapse";a.storage.get(b)&&d(this,!0)})},reload:function(){a.post("?sidebar=1",function(d){a.sidebar.sidebar.html(d);a.sidebar.init();d=a.hub.helper.cleanHash();a("#wa-app > .sidebar li.selected").removeClass("selected");var b=a('#wa-app > .sidebar li a[href="'+d+'"]');!b.length&&2<d.length&&(b=a('#wa-app > .sidebar li a[href="#/'+d.replace(/\/[^\/]+\/$/,"")+'/"]'));b.length&&b.parent().addClass("selected")})}}})(jQuery);
